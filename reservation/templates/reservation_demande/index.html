{% extends "base.html" %}

{% load humanize %} 

{% load static %}

{% block content %}		
    <div class="content">
		<div class="row">
            <div class="col-sm-5" style="color: #fff; padding-left: 20px; background-color: #ca224b;">
                <div align="center">
                    <h3><span style="color: #e3e3e3;"><b>Réservation à la demande</b></span></h3>
                </div>
                <br/>
                <div id="instructions" align="center">
                    <div><h3 style="color: #e3e3e3; font-size: large;"><b>INSTRUCTIONS</b></h3></div>
                    <p style="color: #e3e3e3;">
                        Veuillez entrer les adresses source et destination de votre réservation au niveau de la carte pour calculer l'itinéraire.
                    </p>
                    <p style="color: #e3e3e3;">
                        Ensuite, veuillez sélectionner le véhicule qui vous convient le mieux.
                    </p>
                    <br/>
                    <div id="myCarousel" class="carousel slide" data-ride="carousel" >
                        <!-- Indicators -->
                        <ol class="carousel-indicators">
                          <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                          <li data-target="#myCarousel" data-slide-to="1"></li>
                          <li data-target="#myCarousel" data-slide-to="2"></li>
                        </ol>
                      
                        <!-- Wrapper for slides -->
                        <div class="carousel-inner">
                          <div class="item active">
                            <img style="height: 340px; width: 100%;" src="{% static '/img/demand_hybrid.jpg' %}" alt="EXCLUSIV ON DEMAND (HYBRID)">
                            <div class="carousel-caption" style="padding-top:85px;">
                                <h1 style="color: #454243;">EXCLUSIV ON DEMAND <span style="color: #ca224b;">(HYBRID)</span></h1>
                                <p></p>
                              </div>
                          </div>
                      
                          <div class="item">
                            <img style="height: 340px; width: 100%;" src="{% static '/img/demand_electric.jpg' %}" alt="EXCLUSIV ON DEMAND (ELECTRIC)">
                            <div class="carousel-caption" style="padding-top:65px;">
                                <h1 style="color: #454243;">EXCLUSIV ON DEMAND <span style="color: #ca224b;">(ELECTRIC)</span></h1>
                                <p></p>
                              </div>
                          </div>
                          
                          <div class="item">
                            <img style="height: 340px; width: 100%;" src="{% static '/img/shared.jpg' %}" alt="SHARED ON DEMAND">
                            <div class="carousel-caption" style="padding-top:85px;">
                                <h1 style="color: #e3e3e3;">SHARED ON DEMAND <span style="color: #ca224b;"></span></h1>
                                <p></p>
                              </div>
                          </div>
                        </div>
                      
                        <!-- Left and right controls -->
                        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                          <span class="glyphicon glyphicon-chevron-left"></span>
                          <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#myCarousel" data-slide="next">
                          <span class="glyphicon glyphicon-chevron-right"></span>
                          <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                <div id="details" style="display: none;" align="center">
                    <h4 style="color: #e3e3e3; font-size: large;"><b>DETAILS DE VOTRE TRANSFERT</b></h4>
                    <div class="card">
                        <div class="card-body" style="margin-top: -25px;">
                            <hr>
                            <h5 style="color: #e3e3e3;"> <b>Adresse de départ:</b> <span id="depart"></span></h5>
                            <h5 style="color: #e3e3e3;"> <b>Adresse d'arrivée:</b> <span id="arrivee"></span></h5>
                            <h5 style="color: #e3e3e3;"> <b>Distance:</b> <span id="distance"></span></h5><span hidden id="hidden_cost"></span>
                            <h5 style="color: #e3e3e3;"> <b>Durée du trajet:</b> <span id="duree"></span></h5>
                            <hr>
                        </div>
                    </div>
                    <div id="myCarousel1" class="carousel slide" data-ride="carousel" >
                        <!-- Indicators -->
                        <ol class="carousel-indicators">
                          <li data-target="#myCarousel1" data-slide-to="0" class="active"></li>
                          <li data-target="#myCarousel1" data-slide-to="1"></li>
                          <li data-target="#myCarousel1" data-slide-to="2"></li>
                        </ol>
                      
                        <!-- Wrapper for slides -->
                        <div class="carousel-inner">
                          <div class="item active">
                            <img style="height: 300px; width: 100%;" src="{% static '/img/demand_hybrid1.jpg' %}" alt="EXCLUSIV ON DEMAND (HYBRID)">
                            <p class="card-price" style ="z-index: 200; position: absolute; top:71px; left: 491px;"><span id="cost_hybrid"></span> €</p>
                            <div class="carousel-caption" style="padding-top:85px;">
                                <h3 style="color: #454243;">EXCLUSIV ON DEMAND <span style="color: #ca224b;">(HYBRID)</span></h3>
                            </div>
                            <div align="right" style="margin-top:-40px;padding-right: 100px;"><button class="btn btn-large btn-success js-create-entity" data-url="{% url 'hybrid_reservation_create' %}?type=1">Commander <span style="padding-left: 5px;"><i class='fa fa-check' style='color:#ffffff;'></i></span></button></div>
                          </div>
                      
                          <div class="item">
                            <img style="height: 300px; width: 100%;" src="{% static '/img/demand_electric1.jpg' %}" alt="EXCLUSIV ON DEMAND (ELECTRIC)">
                            <p class="card-price" style ="z-index: 200; position: absolute; top:71px; left: 491px;"><span id="cost_electric"></span> €</p>
                            <div class="carousel-caption" style="padding-top:65px;">
                                <h3 style="color: #454243;">EXCLUSIV ON DEMAND <span style="color: #ca224b;">(ELECTRIC)</span></h3>
                            </div>
                            <div align="right" style="margin-top:-40px;padding-right: 100px;"><button class="btn btn-large btn-success js-create-entity" data-url="{% url 'electric_reservation_create' %}?type=0">Commander <span style="padding-left: 5px;"><i class='fa fa-check' style='color:#ffffff;'></i></span></button></div>
                          </div>
                          
                          <div class="item">
                            <img style="height: 300px; width: 100%;" src="{% static '/img/shared1.jpg' %}" alt="SHARED ON DEMAND">
                            <p class="card-price" style ="z-index: 200; position: absolute; top:71px; left: 491px;"><span id="cost_shared"></span> €</p>
                            <div class="carousel-caption" style="padding-top:85px;">
                                <h3 style="color: #454243;">SHARED ON DEMAND <span style="color: #ca224b;"></span></h3>
                            </div>
                            
                            <div align="right" style="margin-top:-40px;padding-right: 100px;"><button class="btn btn-large btn-success js-create-entity" data-url="{% url 'shared_reservation_create' %}?type=2">Commander <span style="padding-left: 5px;"><i class='fa fa-check' style='color:#ffffff;'></i></span></button></div>
                          </div>
                        </div>
                      
                        <!-- Left and right controls -->
                        <a class="left carousel-control" href="#myCarousel1" data-slide="prev">
                          <span class="glyphicon glyphicon-chevron-left"></span>
                          <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#myCarousel1" data-slide="next">
                          <span class="glyphicon glyphicon-chevron-right"></span>
                          <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                <div align="center" style="margin-top: 10px;"><a href="{% url 'reservation_demande_list' %}" class="btn" style="background-color: #454243; color:#fff">Vos commandes</a></div>
            </div>
            <div class="col-sm-7">
                <!--  the map -->
                <div id='map'></div>
                
            </div>
        </div>
    </div>
{% endblock content %}

{% block javascript %}
    <script>
        directions.on('route', (event) => {
            const instructions = document.getElementById('instructions');
            const details = document.getElementById('details');
            instructions.style.display = 'none';
            details.style.display = 'block';
            const mb_source = document.querySelector("#mapbox-directions-origin-input .mapboxgl-ctrl-geocoder input");
            const mb_destination = document.querySelector("#mapbox-directions-destination-input .mapboxgl-ctrl-geocoder input");
            const sp = document.getElementById('depart');
            const sp_arrivee = document.getElementById('arrivee');
            const sp_distance = document.getElementById('distance');
            const sp_cost_hybrid = document.getElementById('cost_hybrid');
            const sp_cost_electric = document.getElementById('cost_electric');
            const sp_cost_shared = document.getElementById('cost_shared');
            const sp_duree = document.getElementById('duree');
            const mb_distance = document.querySelector(".mapbox-directions-route-summary h1");
            const mb_duree = document.querySelector(".mapbox-directions-route-summary span");
            let routes = event.route;
            sp.textContent=mb_source.value
            sp_arrivee.textContent=mb_destination.value;
            sp_distance.textContent=mb_distance.textContent;
            sp_duree.textContent=mb_duree.textContent;
            sp_cost_electric.textContent = Math.round(parseInt(mb_distance.textContent) * parseFloat('{{ tarif.km_cost|stringformat:"f" }}') * parseFloat('{{ tarif.electric_coef|stringformat:"f" }}'));
            sp_cost_hybrid.textContent = Math.round(parseInt(mb_distance.textContent) * parseFloat('{{ tarif.km_cost|stringformat:"f" }}') * parseFloat('{{ tarif.hybrid_coef|stringformat:"f" }}'));
            sp_cost_shared.textContent = Math.round(parseInt(mb_distance.textContent) * parseFloat('{{ tarif.km_cost|stringformat:"f" }}'));
            
        })
    </script>
{% endblock %}