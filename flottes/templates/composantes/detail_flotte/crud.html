{% block javascript %}
  <script type="text/javascript">
    

    function InitializeFields() {
      // Reinitiliser les champs de saisie
      $("#id_quantite").val(0);
      $("#id_typee").val('');
    }

    function AddDetails(id_flotte) {
      var id_quantite = $("#id_quantite").val()
      var id_type = $("#id_type").val()
      
      if(id_quantite < 0){
        return Helpers.ShowMessageAlert("&nbsp; La quantité doit être positive &nbsp;");
      }

      if(id_type === 0){
        return Helpers.ShowMessageAlert("&nbsp; Le type est recquis &nbsp;");
      }

      // Performe save
      $.ajax({
        url : "{% url 'detail_flotte_create' %}",
        type : "POST",
        data : {"id_flotte" : id_flotte, 
                "id_quantite" : id_quantite ,
                "id_type": id_type
        },
        dataType : "json",
        success : function(data){
          if (data['error'] != undefined) {
            return Helpers.ShowMessageAlert(data['error']);
          } else {
            $("#id-details-entity-table" + " tbody").html(data.html_content_list);
            InitializeFields();       
          }
        },
      });
    }

    function DeleteDetails(id_flotte, id_detail){   
      $.ajax({
        url : "{% url 'detail_flotte_delete' %}",
        type : "POST",
        data : {"id_flotte" : id_flotte, "id_detail": id_detail},
        dataType : "json",
        success : function(data){
            $("#id-details-entity-table" + " tbody").html(data.html_content_list).promise().done(function(){
              InitializeFields();
            });
          }
      });
    }
    $('.modal-dialog').css('margin-top', '200px');
  </script>
{% endblock %}

{% load flotte_filter %}

{% load widget_tweaks %}

<form>
  {% csrf_token %}
  <div class="modal-header">
    <h5 class="modal-title"><i class="fa fa-map-o"></i>&nbsp;Détails de la location</h5>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="form-group bg-light" style="padding-top: 5px;">
      <div class="row">
        <div class="form-group col-sm-6">
          <p>
            <label for="{{ form.type.id_for_label }}">{{ form.type.label_tag }}</label>
            {% render_field form.type class+="form-control" %}
          </p>
        </div>
        <div class="form-group col-sm-6">
          <p>
            <label for="{{ form.quantite.id_for_label }}">{{ form.quantite.label_tag }}</label>
            {% render_field form.quantite class+="form-control" %}
          </p>
        </div>
      </div>

      <div class="row">
        
        <div class="col-sm-12" style="padding-top: 18px; padding-bottom: 18px;" align="center">
          <button type="button" title="Ajouter details" 
            enabled='enabled' 
            class="btn btn-success float-right" onclick="AddDetails('{{ obj.id }}')">
            <i class="fa fa-plus"></i>
          </button>
        </div>
        
      </div>
    </div> 
    <br>
    <div class="form-group row">
      <div class="form-group col-sm-12" style="max-height: 300px; overflow-y: auto;">
        <table class="table table-hover table-bordered table-striped table-outline mb-0 nowrap" id="id-details-entity-table" width="100%" cellspacing="0">
          <thead class="thead-default">
            <tr>
              <th class="text-center">Type de véhicule</th>
              <th class="text-center">Quantité</th>
              <th class="text-center">Prix</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            {% include 'composantes/detail_flotte/content.html' %}
          </tbody>
        </table> 
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary btn-round ml-auto" data-dismiss="modal" onclick="location.href='{% url 'flotte_list' %}'"><i class="fa fa-close"></i>&nbsp;Fermer</button>
  </div>
</form>